 Découverte de motifs séquentiels et de règles inattendus D H Li A Laurent P Poncelet LGI2P EMA SITE EERIE {haoyuan li pascal poncelet} ema fr LIRMM CNRS Université Montpellier II laurent lirmm fr Résumé Les travaux autour de l’extraction de motifs séquentiels se sont par ticulièrement focalisés sur la définition d’approches efficaces pour extraire en fonction d’une fréquence d’apparition des corrélations entre des éléments dans des séquences Même si ce critère de fréquence est déterminant le décideur est également de plus en plus intéressé par des connaissances qui sont représenta tives d’un comportement inattendu dans ces données erreurs dans les données fraudes nouvelles niches Dans cet article nous introduisons le problème de la détection de motifs séquentiels inattendus par rapport aux croyances du do maine Nous proposons l’approche USER dont l’objectif est d’extraire les motifs séquentiels et les règles inattendues dans une base de séquences 1 Introduction Pour faire face aux besoins des nouvelles applications médicales suivi de consommation suivi des navigations sur un serveur Web etc de plus en plus de données sont stockées sous la forme de séquences Pour traiter ces bases et en extraire des connaissances pertinentes les motifs séquentiels ont été proposés Agrawal et Srikant 1995 Ils permettent étant donnée une base de données de séquences de trouver toutes les séquences maximales fréquentes au sens d’un support minimal défini par l’utilisateur Si la découverte de corrélations dans les données séquentielles est primordiale pour le décideur il n’en reste pourtant pas moins que certains problèmes ne peuvent être résolus par la recherche de tendances De nouveaux motifs intéressent le décideur les motifs inattendus qui contredisent les croyances acquises sur le domaine pour par exemple détecter des attaques sur un réseau Rappelons que notre objectif n’est pas de trouver les motifs rares mais bien les motifs contredisant une connaissance ce qui n’existe pas dans la littérature La recherche de connais sance inattendue à partir d’une base de croyance a été introduite dans Silberschatz et Tuz hilin 1995 et Padmanabhan et Tuzhilin 2006 présentent une approche de découverte de règles d’association inattendues Spiliopoulou 1999 propose un cadre basé sur la connais sance du domaine et des croyances pour trouver des règles séquentielles inattendues à partir de séquences fréquentes Même si ces travaux considèrent des séquences inattendues ils sont différents de notre problématique dans la mesure où la notion d’inattendue concerne des sé quences fréquentes sur la base afin de trier les résultats obtenus Notre objectif est d’extraire à Motifs séquentiels et règles inattendus partir d’une base toutes les séquences inattendues et d’obtenir des règles elles mêmes inatten dues Dans cet article nous définissons donc la notion de base de croyances et de contradiction dans le contexte des séquences Nous parlons alors de séquence inattendue et nous introdui sons les méthodes de découverte de telles séquences Etant donné que les motifs séquentiels traditionnels ne mettent pas en évidence des règles du type "antécédent conséquent" nous étendons la notion de séquences inattendues à celles de règles inattendues Pour extraire ces règles à partir d’une base de données de séquences et d’une base de croyances nous proposons l’approche USER Unexpected Sequence Extracted Rules 2 USER Motifs séquentiels et règles inattendus Soit un ensemble d’attributs distincts on nomme item i un attribut de cet ensemble Un itemset I est une collection non ordonnée d’items notée i1i2 im Une séquence s est une liste ordonnée d’itemsets notée 〈I1I2 Ik〉 Une base de séquences D est un ensemble de séquences de taille potentiellement très grande Soient deux séquences s = 〈I1I2 Im〉 et s′ = 〈I ′1I ′2 I ′n〉 on dit que s est une sous séquence de s′ notée s v s′ s est contenu dans s′ s’il existe des entiers 1 ≤ i1 < i2 < < im ≤ n tels que I1 ⊆ I ′i1 I2 ⊆ I ′ i2 Im ⊆ I ′im Dans un ensemble de séquences si une séquence s n’est une sous séquence d’aucune autre elle est dite maximale sinon si s est contenue dans s′ on dit que s′ supporte la séquence s Soit une séquence s = 〈I1I2 Ik〉 un segment g v s est une sous séquence qui contient des itemsets contigus 〈IiIi+1 Ii+n〉 avec i ≤ 1 et i + n ≤ k Le support d’une séquence est défini comme la proportion de séquences dans D qui supportent cette séquence Nous définissons dans cet article la longueur d’une séquence comme le nombre d’itemsets qu’elle contient noté |s| Nous considérons également la séquence vide et la concaténation de séquences Une séquence vide est notée ∅ avec s = ∅ ⇐⇒ |s| = 0 Soient deux séquences s1 et s2 la concaténation s1 · s2 de ces deux séquences correspond à s1 complétée par s2 en fin de séquence Nous avons alors |s1 · s2| = |s1|+ |s2| Pour simplifier les notations et la lecture dans la suite de cet article nous utilisons les ma juscules A B C pour décrire des items et la notation ABC pour désigner des itemsets La notation 〈 A AC BC 〉 désigne une séquence A puis A et C puis B et C Nous notons 〈op n〉 une contrainte sur la longueur de séquences avec op ∈ {6= = < ≤ > ≥} et n ∈ N La notation |s′| |= 〈op n〉 signifie que la longueur de la séquence satisfait 〈op n〉 Dans le cas où l’on a 〈op n〉 = 〈≥ 0〉 on note Soit une séquence s avec s1 et s2 deux sous séquences de s i e s1 s2 v s telles que s1 apparaisse avant s2 dans s On a donc s = s1 · g · s2 L’expression s1 7→〈op n〉 s2 indique que s1 et s2 apparaissent dans la séquence s = s1 · g · s2 avec g vérifie 〈op n〉 Dans le cas où 〈op n〉 = 〈= 0〉 g = ∅ nous notons s1 7→ s2 le fait que s1 soit directement suivi de s2 dans la séquence s Nous avons alors 〈 s1 7→〈= 0〉 s2 〉 ≡ 〈s1 7→ s2〉 Dans le cas le moins contraint l’écriture s1 7→ s2 désigne le fait que s2 apparaît après s1 dans s s = s1 · s′ · s2 sans contrainte sur s′ Une croyance représente une connaissance décrite sous la forme d’une relation de causalité temporelle entre des occurrences d’éléments dans une séquence RNTI G D H Li et al Dans notre approche nous utilisons des règles pour décrire les relations de causalité entre séquences De manière similaire à Spiliopoulou 1999 nous notons sα la prémisse et sβ la conclusion Ceci signifie que sα ⇒ sβ est satisfaite dans s si l’occurrence de sα v s implique l’occurrence d’une sous séquence sβ v s telle que sα · sβ v s Dans notre approche ce sont les experts qui définissent les croyances à prendre en compte Définition 1 Croyance Une croyance b sur une séquence est un couple p C tel que b p C où p sα ⇒ sβ C {τ η} τ 〈op n〉 op ∈ {6= = < ≤ > ≥} n ∈ N et η sβ 6∼ sγ p et τ forment alors une règle sα 7→〈op n〉 sβ et η spécifie que l’occurrence de sβ ne peut pas être remplacée par une occurrence de sγ La croyance c est alors notée [sα sβ sγ τ ] Dans le cas où τ = 〈≥ 0〉 on note Soit une croyance b une séquence s est inattendue par rapport à b si s viole l’une des contraintes introduites par b En nous appuyant sur ces contradictions possibles de contraintes nous distinguons trois types de violation caractères inattendus α inattendu β inattendu γ inattendu Définition 2 Soit une croyance b = [sα sβ sγ ] et une séquence s s est dite α inattendue par rapport à b si sα v s et il n’existe pas sβ sγ tels que 〈sα 7→ sβ〉 v s ou 〈sα 7→ sγ〉 v s Soit une croyance b = [sα sβ sγ τ ] où la contrainte τ est différente de et une séquence s s est dite β inattendue par rapport à b si 〈sα 7→ sβ〉 v s et s’il n’existe pas s′ tel que |s′| |= τ et 〈sα 7→ s′ 7→ sβ〉 v s Soit une croyance b = [sα sβ sγ τ ] et une séquence s s est dite γ inattendue par rapport à b si 〈sα 7→ sγ〉 v s et il existe s′ tel que |s′| |= τ et 〈sα 7→ s′ 7→ sγ〉 v s Notons qu’une séquence inattendue peut être liée à deux contraintes violées Ainsi une séquence peut être à la fois α et γ inattendue ou être à la fois β et γ inattendue Il est à présent intéressant de découvrir les tendances au sein de ces séquences par exemple pour caractériser une attaque ou une fraude Nous utilisons pour cela le cadre des motifs séquentiels À partir d’une base de données de séquences D et d’une base de croyances B nous utilisons le support pour déterminer à quel point une séquence inattendue su issue d’une séquence s ∈ D est fréquente au sens de la croyance b ∈ B et du type d’inattendu u ∈ {α β γ} On note Du le sous ensemble de D composé des séquences violant b pour le type d’inattendu u On a alors supp su = |{s ∈ Du|su v s}| |Du| Définition 3 Soit une base de données D u un type d’inattendu de contrainte et Du le sous ensemble deD contenant les séquences s v D telles que s est une u inattendu de croyance Un motif séquentiel inattendu est une séquence maximale fréquente c’est à dire dont le support est supérieur à un seuil fixé par l’utilisateur Afin de mieux identifier les segments de séquence correspondant à la partie "souche" et aux parties de contradiction nous introduisons la notion de séquence inattendue bornée Définition 4 Soit une croyance b = [sα sβ sγ ] et une séquence s telle que s = g′ · sα · g avec sα 6v g′ sβ 6v g sγ 6v g s est α inattendue pour b La séquence α inattendue bornée est définie comme le segment sb = sα ·g Soit une croyance b = [sα sβ sγ τ ] et une séquence RNTI G Motifs séquentiels et règles inattendus s telle que s = g′ · sα · g · sβ · g′′ où le segment g ne satisfait pas τ s est β inattendue pour b La séquence β inattendue bornée est définie comme le segment sb = sα · g · sβ Soit une croyance b = [sα sβ sγ τ ] et une séquence s = g′ · sα · g · sγ · g′′ où le segment g satisfait τ s est γ inattendue pour b La séquence γ inattendue bornée est définie comme le segment sb = sα · g · sγ Une séquence inattendue s peut donc être représentée comme s = ga · sb · gc où sb est une séquence bornée inattendue correspondant à la violation de contrainte de croyance et ga gc sont deux segments de s Nous avons |sb| > 0 |ga| ≥ 0 et |gc| ≥ 0 Le segment ga v s est appelé antécédent et le segment gc v s est appelé conséquent Le support d’une séquence sa contenu dans Dau et sc contenu Dcu est la fraction de séquences de Dau ou de Dcu qui supportent sa ou sc c’est à dire supp sa = |{s ∈ Dau|sa v s}| |Dau| et supp sc = |{s ∈ Dcu|sc v s}| |Dcu| Une séquence maximale fréquente contenue dans Dau est une séquence antécédent fré quente et une séquence fréquente maximale contenue dans Dcu est une séquence fréquente conséquente Définition 5 Règle Antécédente et Règle Conséquente Soit un ensemble Du de séquences inattendues de type u ∈ {α β γ} Soit Dau l’ensemble de toutes les séquences antécédentes contenues dans Du et sa une séquence antécédente contenue dans Dau fréquente par rapport à un support défini par l’utilisateur σa Une règle antécédente est une règle de la forme sa ⇒ u Soit Dcu l’ensemble de toutes les séquences conséquentes contenues dans Du et soit sc la sé quence conséquente contenue dans Dcu fréquente par rapport au seuil σc fixé par l’utilisateur Une règle conséquente est une règle de la forme u⇒ sc Les règles antécédentes reflètent les éléments d’une séquence qui sont en amont d’une violation de contrainte d’une croyance donnée Les règles conséquentes reflètent les éléments d’une séquence qui correspondent au caractère inattendu par rapport à une croyance Décrites par leur support les règles antécédentes et conséquentes sont également décrites par leur confiance Nous avons donc supp sa ⇒ u = supp sa et supp u ⇒ sc = supp sc Définition 6 Support et Confiance de règles Soit une base de données de séquences D et un type d’inattendu u Soit l’ensemble d’antécédents Dau et l’ensemble des conséquents Dcu La valeur du support d’une règle sa ⇒ u équivaut à la valeur de support de sa de même que la valeur de support de u⇒ sc est égale à la valeur de support de sc conf sa ⇒ u = |{s ∈ Dau|sa v s}| |{s ∈ D|sa v s}| conf u⇒ sc = |{s ∈ Dcu|sc v s}| |{s ∈ D|s |= u}| 2 1 L’approche USER Nous supposons connue une base de croyances et cherchons les comportements inatten dus dans une base de données de séquences L’approche décrite ici s’articule autour de deux phases Dans la première phase l’algorithme USE Unexpected Sequence Extraction extrait toutes les séquences inattendues pour chaque type de violation de contrainte et pour chaque croyance Dans une seconde phase l’algorithme USR Unexpected Sequence Rules trouve tous les motifs séquentiels inattendus et les règles associées à partir des séquences inatten dues trouvées par USE à partir de seuils de support confidence définis a priori Différentes RNTI G D H Li et al Algorithm 1 Algorithme USE Input Base de séquences D et base de croyances B Output Ensemble Du de séquences inattendues Dau de séquences antécédentes et Dcu de séquences conséquentes pour chaque type de violation u 1 for all s ∈ D do 2 for all b ∈ B do 3 * α inattendus * 4 for all uα ` b do 5 if occuα ← matchi s b sα then 6 if not matchf s b sβ occuα and not matchf s b sγ occuα then 7 Duα ← Duα ∪ s Dauα ← D a uα ∪ subseq s s begin occuα begin 8 Dcuα ← D c uα ∪ subseq s occuα end s end 9 end if 10 end if 11 end for 12 * β inattendus * 13 for all uβ ` b do 14 if occuα ← matchi s b sα and occuβ ← matchf s b sβ occuα b τ then 15 Duβ ← Duβ ∪ s Dauβ ← D a uβ ∪ subseq s s begin occuα begin 16 Dcuβ ← D c uβ ∪ subseq s occuβ end s end 17 end if 18 end for 19 * γ inattendus * 20 for all uγ ` b do 21 if occuα ← matchi s b sα and occuγ ← matchf s b sγ occuα b τ then 22 Duγ ← Duγ ∪ s Dauγ ← D a uγ ∪ subseq s s begin occuα begin 23 Dcuγ ← D c uγ ∪ subseq s occuγ end s end 24 end if 25 end for 26 end for 27 end for 28 output Du Dau Dcu for each u ` b ∈ B expérimentations ont été réalisées sur des jeux de données réelles Web Log et synthétiques pour extraire des règles inattendues et étudier le passage à l’échelle des algorithmes Le lecteur intéressé peut se reporter à Li et al 2007 3 Conclusion Dans cet article nous avons introduit la problématique de la recherche de motifs séquen tiels et règles séquentielles inattendus qui trouve de très nombreuses applications dans les bases de données réelles détection de pannes de fraudes de niches commerciales etc L’approche USER est proposée décomposée en différentes étapes successives USE USR RNTI G Motifs séquentiels et règles inattendus Algorithm 2 Algorithme USR Input Base de séquencesD base de croyances B ensembles de séquences produits par USE valeurs de support minimum σu σa σc et valeurs de confiance minimale δa δc Output Ensemble Pu de motifs séquentiels inattendus ensemble Rau de règles antécédentes inattendues et Rcu de règles conséquentes inattendues pour chaque type de violation u 1 for all b ∈ B do 2 for all u ` b do 3 Pu ← FindSequentialPatterns Du σu 4 return Pu 5 Pau ← FindSequentialPatterns Dau σa 6 Pcu ← FindSequentialPatterns Dcu σc 7 for all sa ∈ Pau do 8 if |sa| |D| ≥ δa then 9 Rau ← Rau ∪ {sa ⇒ u} 10 end if 11 end for 12 return Rau 13 for all sc ∈ Pcu do 14 if |sc| |Du| ≥ δa then 15 Rcu ← Rcu ∪ {u⇒ sc} 16 end if 17 end for 18 outputRcu 19 end for 20 end for Références Agrawal R et R Srikant 1995 Mining sequential patterns In ICDE pp 3–14 Li D H A Laurent et P Poncelet 2007 Découverte de motifs séquentiels et de règles inattendus In Internal Research Report LIRMM Padmanabhan B et A Tuzhilin 2006 On characterization and discovery of minimal unex pected patterns in rule discovery IEEE Trans Knowl Data Eng 18 2 202–216 Silberschatz A et A Tuzhilin 1995 On subjective measures of interestingness in knowledge discovery In KDD pp 275–281 Spiliopoulou M 1999 Managing interesting rules in sequence mining In PKDD Summary When considering domain knowledge within the data mining process the most interesting sequences might not be the sequences corresponding to existing knowledge In this paper we introduce the problem of finding unexpected behaviors within the context of sequence mining RNTI G 