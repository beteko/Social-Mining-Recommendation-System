 Un algorithme ICM basé sur la compacité pour la segmentation des images satellites à très haute résolution Jérémie Sublime Younès Bennani Antoine Cornuéjols AgroParisTech INRA UMR MIA 518 16 rue Claude Bernard F 75231 Paris Cedex 5 France jeremie sublime agroparistech fr antoine cornuejols agroparistech fr Université Paris 13 Sorbonne Paris Cité Laboratoire d’Informatique de Paris Nord CNRS UMR 7030 younes bennani lipn univ paris13 fr Résumé Dans cet article nous proposons une modification pour l’algorithme "Iterated Conditional Modes" ICM appliqué à la segmentation d’images à très haute résolution Pour ce faire nous introduisons un nouveau critère de conver gence basé sur la compacité des clusters et qui repose sur une fonction d’énergie adaptée aux modèles de voisinages irréguliers de ce type d’images Grâce à cette méthode nos premières expériences ont montré que nous obtenons des résul tats plus fiables en terme de convergence et de meilleure qualité qu’en utilisant l’énergie globale comme critère d’arrêt 1 Introduction Avec la récente explosion du nombre d’images et de données satellites disponibles la conception de systèmes capables d’interpréter automatiquement de telles données est devenue un domaine florissant En effet les satellites modernes sont capables d’acquérir des images à très hautes résolutions THR avec une définition de plus en plus élevée sur un large do maine spectral Or les algorithmes capables de traiter un tel volume de données en un temps raisonnable sont pour le moment assez rares La segmentation de telles données d’imageries peut se faire en utilisant des algorithmes basés sur les champs de Markov Roth et Black 2011 Les champs de Markov reposent sur la notion de voisinage pour modéliser les dépendances qui peuvent exister entre des données telles que des pixels adjacents ou des super pixels adjacents groupes de pixels Dans ces modèle on considère S = {s1 sN} si ∈ 1 K un ensemble de variables aléatoires représentant les états labels des données Ces états sont supposés liés dans l’espaces par des relations de voisinages et émettent des observations X = {x1 xN} où les xi sont des vecteurs contenant les attributs de chaque donnée RGB pour les modèles les plus simples L’objectif est alors de déterminer la configuration idéale de S c’est à dire de trouver les valeurs des si afin d’obtenir une segmentation optimale Une des méthodes possibles pour résoudre ce problème est l’utilisation du couple ICM EM Zhang et al 2001 Le choix de l’algorithme ICM Besag 1986 vient du fait que cet 191 Algorithme C ICM pour la segmentation des images satellites THR algorithme a une complexité plus faible que celles des algorithmes plus récents utilisés pour les champs de Markov ce qui est un atout non négligeables pour traiter le volume important des données d’une image à très haute résolution De plus la plupart des données issues de telles images sont déjà pré traitées et l’ICM est donc suffisant pour les segmenter Il est également important de préciser qu’à ce jour l’algorithme ICM est le seul à avoir été adapté pour pouvoir optimiser le modèle d’énergie contenant des informations sémantiques utiles dans le cadre des image satellites que nous avons proposé dans de précédent travaux Sublime et al 2014 L’objectif de l’algorithme ICM est d’optimiser itérativement une fonction d’énergie locale dérivant du logarithme de P x|s θs P s Bien que cet algorithme ait montré son efficacité pour résoudre ce problème il a cependant plusieurs défauts tels que son critère d’arrêt basé sur l’évolution de l’énergie global et l’absence de garantie de convergence En effet cet algorithme essaye d’optimiser une fonction non convexe et il a été montré qu’après un processus d’opti misation relativement rapide de forme parabolique l’algorithme ne se stabilisait pas toujours et pouvait même se mettre à diverger entrainant ainsi une détérioration des résultats Zhang 1989 Une des difficultés récurrente de la segmentation d’image dans le cadre non supervisé est qu’il est difficile d’évaluer la qualité des résultats Dans le cas de l’ICM le critère d’arrêt repose sur l’énergie globale liée aux champs de Markov somme des énergies locales et sur l’hypothèse que cette énergie va se stabiliser Le problème d’une telle approche est précisément que cette énergie globale ne se stabilise pas toujours l’algorithme n’ayant pas de garantie de convergence et que même dans le cas où elle se stabilise cette stabilisation n’intervient pas né cessairement au moment où les résultats de la segmentation sont les meilleurs De plus en se basant sur l’énergie globale avec un nombre de données élevé il y a un risque non négligeable d’"overflow" ou d’arrondi de cette énergie Dans cette article nous proposons un nouveau critère d’arrêt pouvant être facilement calculé et qui repose sur un modèle d’énergie adapté aux images satellites à très haute résolution 2 Algorithme proposé On note Vx le voisinage d’une observation x et A = {ai j}K×K la matrice de voisinage de l’image où chaque ai j est la probabilité de passer de l’état i à l’état j entre deux données voisines A partir de ces notations nous utilisons comme modèle d’énergie locale le modèle défini lors de nos précédents travaux Sublime et al 2014 U s x = x− µs T Σ−1s x− µs + log √ |Σs| 2π d − ∑ v∈Vx τx v × log asv s 1 La fonction d’énergie décrite précédemment utilise une énergie locale dérivant de la loi normale dans laquelle µs est la valeur moyenne associée à l’état s et Σs sa matrice de cova riance Le dernier membre de cette énergie qui décrit l’énergie de voisinage est une fonction positive calculée à partir des éléments de la matrice A Le facteur τx v représente le poids de v en tant que voisin de la donnée x selon la proportion de frontière qu’il occupe Ce modèle repose sur l’idée que des données voisines ayant des clusters différents ne sont pas nécessaire ment incompatibles et peut être vu comme une version relaxée du graph cuts Boykov et al 2001 192 J Sublime et al La matrice de voisinage A de ce modèle d’énergie contient des informations sémantiques telles que les affinités des différents clusters ou leur compacité sur l’image En effet la diago nale de la matrice A contient la probabilité pour chaque cluster d’avoir un voisinage plus ou moins composé d’éléments du même cluster Cette diagonale peut par conséquent être consi dérée comme un indicateur de compacité des clusters Les éléments non diagonaux quant à eux fournissent des informations sur les affinités des clusters Étant donné que l’objectif principal de l’utilisation des champs de Markov en segmentation d’image est d’obtenir des zones homogènes nous avons décidé d’utiliser cette information de compacité contenue dans notre matrice de voisinage et d’en faire le nouveau critère d’arrêt de notre algorithme C ICM "Compactness based Iterated Conditional Modes" Il est en effet raisonnable de supposer qu’il faut arrêter l’algorithme lorsque la compacité des clusters cesse d’augmenter Aussi nous utilisons les variations de la trace de la matrice A comme nouveau critère d’arrêt Ce critère présente plusieurs avantages Les calculs sont faciles et plus rapides que ceux pour obtenir l’énergie globale ce critère permet également de repérer les cas où un cluster commence à en absorber d’autres ce qui arrive assez souvent avec l’ICM Un tel cas de figure provoquerait rapidement la convergence de la trace de A vers 1 Dans l’algorithme 1 nous montrons comment nous avons adapté le framework EM ICM pour notre critère d’arrêt Algorithme 1 Algorithme C ICM Initialisation de S et Θ = µ Σ avec l’EM calcul initial de A Compacité=0 tant que Tr A > Compacité faire Compacité = Tr A Mise à jour de la meilleure configuration de S pour tout x ∈ X faire Minimisation de U s x Equation 1 fin Mise à jour de A fin return dernière meilleure configuration de S 3 Expériences 3 1 Données pixels haute résolution Granville Dans une première expérience nous appliquons notre algorithme sur une image satellite à haute résolution 2014 CNES Spot Image DigitalGlobe Google Cette image est seulement en haute résolution et utilise le modèle pixel RGB sur lequel nous avons appliqué notre algo rithme avec des voisinages d’ordre 1 avec pour objectif de trouver 6 clusters Sur la Figure 1 on peut voir plusieurs étapes de l’évolution de la segmentation sur une zone choisie de l’image pendant cette première expérience La Figure 2 quant à elle montre l’évolution comparative de l’énergie globale et de la compacité calculée avec notre modèle 193 Algorithme C ICM pour la segmentation des images satellites THR Compacité et énergie globale sont toutes deux normalisées entre 0 et 1 pour pouvoir être vi sualisées sur un même graphique FIG 1 – Segmentation résultats des itérations 1 8 43 et 50 FIG 2 – Évolution de l’énergie globale orange et de la compacité des clusters bleu Comme on peut le voir sur la Figure 2 le critère d’arrêt basé sur l’énergie aurait conduit l’algorithme à s’arrêter après la 8ème itération Or sur la Figure 1 l’état de fusion des zones homogènes n’est pas encore assez avancé après l’itération 8 La mer et une partie des bâtiments sont encore très fragmentés Le critère de compacité aurait de son côté amené l’algorithme à s’arrêter après l’itération 43 ce qui aurait conduit à des zones nettement plus homogènes routes eau gros bâtiments etc On notera également que les deux critères se stabilisent définitivement après l’itération 47 itération après laquelle l’image n’évolue presque plus Sur l’image prise après la 50ème itéra tion de l’algorithme on constate même le début assez marqué d’un phénomène de détérioration avec certains clusters qui ont commencé à déborder sur d’autres De cette première expérience nous pouvons tirer les conclusions suivantes Tout d’abord elle confirme la difficulté évoquée dans notre introduction de trouver un critère d’arrêt idéal En effet le critère basé sur l’énergie aurait ici arrêté la segmentation trop tôt et l’énergie rebondit deux fois avant d’atteindre sa stabilisation finale Ensuite on voit que notre critère basé sur la compacité semble plus stable il n’y a pas de rebond Enfin on notera que lorsque les deux critères semblent finalement se mettre d’accord pour arrêter la segmentation itération 43 pour la compacité et itération 47 pour la stabilisation définitive de l’énergie on s’aperçoit que nous 194 J Sublime et al sommes déjà dangereusement proche de la zone à partir de laquelle la segmentation commence à se détériorer 3 2 Données THR Strasbourg Notre seconde expérience a été effectuée sur un jeu de données construit à partir d’une image satellite à très haute résolution de la ville de Strasbourg Rougier et Puissant 2014 Ce jeu de données pré traitées utilise le modèle des super pixels agglomérats de pixels avec des voisinages irréguliers chaque super pixel a entre 1 à 15 voisins L’image est représentée sous forme de 187 058 super pixels ayant chacun 27 attributs radio métriques et géométriques FIG 3 – Évolution de l’énergie globale orange de la compacité bleu et du DB Index gris Le tableau et le graphiques montrés dans la Figure 3 sont issus d’une segmentation à 9 clusters sur ce jeu de données THR Strasbourg On y voit l’évolution de l’énergie globale et celle de la compacité normalisées entre 0 et 1 ainsi que celle d’un indice de qualité de clustering l’indice de Davies Bouldin Davies et Bouldin 1979 normalisé entre 0 5 et 1 5 dont la valeur doit être la plus basse possible On constate à l’issue de cette expérience que notre indice de compacité tombe d’accord avec l’indice de qualité de clustering pour déterminer quand arrêter l’algorithme On notera tout de même qu’il y a peu de différence en terme de qualité de résultats entre le moment d’arrêt décidé par le critère de compacité et celui décidé par le critère classique d’énergie Cependant sur une image satellite à très haute résolution de cette taille 2 itérations supplé mentaires coûtent plusieurs minutes de calcul pour avoir dans le cas de cette expérience un résultat légèrement moins bon Notre critère d’arrêt semble donc être ici un choix plus judi cieux pour décider d’arrêter l’algorithme au bon moment et économiser du temps de calcul 4 Conclusion Dans cet article nous avons proposé une amélioration de l’algorithme ICM pour la seg mentation des images satellites à très haute résolution Notre algorithme C ICM introduit un nouveau critère d’arrêt basé sur un modèle d’énergie spécifique permettant d’avoir des infor mations sur les relations entre les différents clusters Notre critère repose ainsi sur la com pacité et l’homogénéité des clusters dans la segmentation plutôt que sur le traditionnel critère d’énergie globale Nos expériences préliminaires ont montré des résultats intéressants qui pour raient mener à une amélioration globale de l’efficacité et à une vitesse accrue du traitement des 195 Algorithme C ICM pour la segmentation des images satellites THR images à très haute résolution par de futurs algorithmes Nos travaux à venir incluront no tamment l’application et la validation de cet algorithme sur un plus grand nombre de jeux de données Références Besag J 1986 On the statistical analysis of dirty pictures Journal of the Royal Statistical Society Series B 48 3 259–302 Boykov Y O Veksler et R Zabih 2001 Fast approximate energy minimization via graph cuts IEEE Trans Pattern Anal Mach Intell 23 11 1222–1239 Davies D L et D W Bouldin 1979 A cluster separation measure IEEE Transactions on Pattern Analysis and Machine Intelligence 1 2 224–227 Roth S et M J Black 2011 Fields of experts In A Blake P Kohli et C Rother Eds Markov Random Fields for Vision and Image Processing pp 297–310 MIT Press Rougier S et A Puissant 2014 Improvements of urban vegetation segmentation and classi fication using multi temporal pleiades images 5th International Conference on Geographic Object Based Image Analysis 6 Sublime J A Cornuéjols et Y Bennani 2014 A new energy model for the hidden markov random fields In ICONIP 2014 Part II Lecture Notes in Computer Science Volume 8835 pp 60–67 Zhang H 1989 Image Restoration Flexible Neighborhood Systems and Iterated Condi tional Expectations Stanford University Dept of Statistics Laboratory for Computational Statistics Zhang Y M Brady et S M Smith 2001 Segmentation of brain mr images through a hidden markov random field model and the expectation maximization algorithm IEEE Trans Med Imaging 20 1 45–57 Acknowledgements Ce travail a été réalisé dans le cadre du projet ANR COCLICO ANR 12 MONU 0001 Summary In this article we propose a modification to the Iterated Conditional Modes algorithm ap plied to image segmentation To do so we introduce a new confidence criterion to determine whether or not the algorithm should keep updating the segmentation This criterion relies on a transition matrix parameter and is based on the compactness of the segmented areas rather than the image global energy By using this method we ensure a more effective segmentation that gives more compact and meaningful areas than when using the traditional global energy crite rion Our initial experiments on Very High Resolution images have shown promising results 196 C Visualisation et Données Complexes Un algorithme ICM basé sur la compacité pour la segmentation des images satellites à très haute résolution Jérémie Sublime Younès Bennani Antoine Cornuéjols