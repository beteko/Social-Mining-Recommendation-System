 Extraction d’itemsets compacts Bashar Saleh Florent Masseglia Inria Sophia Antipolis Méditérranée Equipe Projet AxIS 2004 route des lucioles BP 93 FR 06902 Sophia Antipolis {Prénom Nom} sophia inria fr sop inria fr axis Résumé L’extraction d’itemsets fréquents est un sujet majeur de l’ECD et son but est de découvrir des corrélations entre les enregistrements d’un ensemble de données Cependant le support est calculé en fonction de la taille de la base dans son intégralité Dans cet article nous montrons qu’il est possible de prendre en compte des périodes difficiles à déceler dans l’organisation des données et qui contiennent des itemsets fréquents sur ces périodes Nous proposons ainsi la définition des itemsets compacts qui représentent un comportement cohérent sur une période spécifique et nous présentons l’algorithme DEICO qui permet leur découverte 1 Introduction Le problème de la recherche de règles d’association introduit dans Agrawal et al 1993 est basé sur l’extraction de corrélations fréquentes entre les enregistrements et connaît de nom breuses applications dans le marketing la gestion financière ou l’analyse décisionnelle par exemple Au cœur de ce problème la découverte d’itemsets fréquents représente un domaine de recherche très étudié Dans l’analyse du panier de la ménagère par exemple les itemsets fréquents ont pour but de découvrir des ensembles d’items qui correspondent à un nombre significatif de clients Si ce nombre est supérieur à un support défini par l’utilisateur alors cet itemset est considéré comme fréquent Cependant dans la définition initiale des itemsets fréquents l’extraction est effectuée sur la base de données toute entière i e soit minsupp le support minimum donné par l’utilisateur les itemsets extraits doivent apparaître dans au moins |D| ×minsupp enregistrements de D Toutefois il est possible que des itemsets intéressants reste ignorés malgré des caractéristiques particulières y compris de support Effectivement les itemsets intéressants sont souvent liés au moment qui correspond à leur observation On pourrait prendre pour exemple le comportement des utilisateurs d’un site de commerce en ligne pendant une offre spéciale sur les DVD et les CD vierges pour laquelle une publicité est faite par mailing De la même manière le site Web d’une conférence peut voir le nombre de connexions augmenter dans une fenêtre de quelques heures avant la date limite de soumission Une condition nécessaire à la découverte de ce type de données est liée à l’aspect temporel des données Cet aspect a déjà été abordé pour les règles d’association dans Ale et Rossi 2000 Extraction d’itemsets compacts Lee et al 2001 Dans Ale et Rossi 2000 les auteurs proposent la notion de règles d’associa tion temporelles Leur idée consiste à extraire les itemsets qui sont fréquents sur des périodes définies par la durée de vie de chaque item les périodes ne sont donc pas découvertes mais utilisées comme contrainte Dans cet article nous proposons de découvrir les itemsets qui sont fréquents sur un sous ensemble contigü de la base de données Par exemple les navigations sur les pages Web des DVD et CD vierges apparaissent de façon distribuée sur toute l’année Cependant la fréquence de ce comportement augmente très certainement pendant les quelques heures ou jours qui suivent le mailing Ainsi le défi consiste à trouver la fenêtre temporelle qui va optimiser le support de ce comportement Considérons que le mailing soit envoyé le 3 mars et qu’il a influencé les clients pendant deux jours Notre but est de découvrir que “25% des clients entre le 3 et le 5 mars ont demandé la page des CD vierges la page des DVD vierges et finalement la page des offres spéciales” Le support de ce comportement est sûrement trop faible pour permettre son extraction sur l’année toute entière mais cette connaissance i e le comportement et la période sur laquelle il est fréquent peut être très utile pour les décideurs qui veulent certainement découvrir ce comportement et sa période de fréquence pour finalement faire le lien avec le mailing 2 Definitions La définition 1 reprend le concept d’itemset fréquent de Agrawal et al 1993 Nous y avons ajouté la notion d’estampille donc une transaction peut couvrir plusieurs dates Définition 1 Soit I = {i1 i2 in} un ensemble d’items Soit X = {i1 i2 ik} k ≤ n et ∀j ∈ [1 k] ij ∈ I X est un itemset ou un k−itemset Soit T = {t1 t2 tm} un ensemble d’estampilles sur lesquelles un ordre linéaire <T est défini et où ti <T tj signifie que ti précède tj Une transaction T est un couple T = tid X ou tid est l’identifiant de la transaction et X est l’itemset associé À chaque item i de X est associé l’estampille ti qui représente la date d’apparition de i dans T Une transaction T = tid I supporte un itemset X ∈ I si X ⊆ I Une base de transactions D est un ensemble de transactions La couverture d’un itemset X sur D est l’ensemble des identifiants de transactions dans D qui supportent X couverture X D = {tid tid I ∈ D X ∈ I} Le support d’un itemset X dans D est le nombre de transactions dans la couverture de X sur D support X D = |couverture X D | La fréquence d’un item set X sur D est le rapport entre la taille de la couverture de X sur D et la taille de D fréquence X D = support X D |D| Soit γ ∈]0 1] le support minimum donné par l’utilisateur un itemset X est dit fréquent si fréquence X D ≥ γ Définition 2 L’ensemble F des itemsets fréquents de D avec un support minimum γ est noté F D γ = {X ∈ I frequence X D ≥ γ} Étant donnés un ensemble d’items I une base de transactions D et un support minimum γ le problème de l’extraction d’itemsets fréquents vise à trouver F D γ ainsi que le support des itemsets de F L’exemple 1 donne une illustration des concepts définis dans cette section B Saleh et F Masseglia Exemple 1 La figure 1 a montre un exemple de base de données D Pour simplifier la lecture nous supposons que les transactions de D sont affichées par ordre de date i e T1 est enregis trée avant T2 etc et qu’une estampille unique est associée à tous les items d’une transaction alors que dans la définition 1 chaque item est estampillé Avec γ = 12 les items fréquents en gras dans les transactions de la figure 1 a sont a b et c Les itemsets fréquents de D sont a b c avec un support de 610 et a c avec un support de 1 2 Fig 1 a Itemsets fréquents Fig 1 b Itemsets compacts FIG 1 – itemsets fréquents et itemsets compacts sur D avec γ = 12 Notre problème est basé sur les estampilles et vise à extraire des itemsets qui sont fréquents sur des périodes particulières de D Nous présentons maintenant les notions d’itemset temporel et d’itemset compact qui sont au cœur de cet article Définition 3 Une période P = Ps Pe est définie par une date de départ Ps et une date de fin Pe L’ensemble des transactions qui appartiennent à une période P est défini par Tr P = {T T ⊆ D ∀i ∈ T Ps ≤ Pi ≤ Pe} avec Pi l’estampille de l’item i dans la transaction T Enfin PR est l’ensemble des périodes possibles sur D En d’autres termes l’ensemble des transactions qui appartiennent à P est l’ensemble des transactions dont tous les items sont estampillés dans les limites de P Définition 4 Un itemset temporel x est un tuple xi xp xσ où xi est un itemset xp est une période associée à xi et xσ est le support de xi sur xp Soit k la taille de xi alors x est un k itemset temporel Soit γ le support minimum nous présentons les caractéristiques d’un itemset compact dans la définition 5 Définition 5 Soit x un itemset temporel x est un itemset compact IC ssi les conditions suivantes sont respectées 1 xσ ≥ γ 2 ∀p2 ∈ PR xp ⊆ p2 alors on observe a ou b ou les deux a support xi p2 < γ b couverture xi p2 =couverture xi xp 3 ∀p2 ∈ PR p2 ⊆ xp couverture xi p2 <couverture xi xp Soit k la taille de xi alors x est un k itemset compact Enfin SIk est l’ensemble de tous les k itemsets compacts Extraction d’itemsets compacts La première condition de la définition 5 assure que x représente un itemset qui est fréquent sur sa période La seconde condition assure que la taille de xp est maximale En fait si une période plus grande existe alors sur cette période xi n’est pas fréquent ou la couverture de xi reste identique i e étendre la période de xp à p2 n’apporte rien au support Enfin la troisième condition assure que la taille de xp est également minimale En effet si xi est supporté par la première et la dernière transaction de xp alors si il existe un période plus petite sur laquelle xi est fréquent la couverture sera plus faible i e passer de xp à p2 implique d’ignorer des transactions qui supportent xi et doivent donc être gardées Une illustration de cette définition est donnée dans l’exemple 2 Exemple 2 La figure 1 b montre les k itemsets compacts qui sont extraits avec γ = 0 5 On peut y constater que les itemsets compacts de taille 1 sont a b et c que leur support est de 610 et que leur période correspond à la base D entière Ensuite on peut observer trois itemsets compacts de taille 2 – a c avec un support de 510 et une période qui couvre toute la base D – a b et b c sur la période [7 10] avec un support de 34 Finalement il y a un itemset compact de taille 3 a b c qui apparaît dans la période [7 10] avec un support de 34 Définition 6 L’ensemble des Itemsets Compacts Maximaux ICM est défini comme suit soit x un IC x est un ICM si les conditions suivantes sont respectées ∀y ∈ SI x 6= y si xi ⊆ yi alors xp 6= yp Dans la suite de ce papier nous proposons un algorithme optimisé pour la découverte de l’ensemble des ICM comme décrits par la définition 6 3 DeICo principe général DEICO introduit un nouveau principe de comptage pour les itemsets candidats Consi dérons un itemset temporel t qui n’est pas compact i e tσ < γ Tout surensemble u = ux up uσ tx ⊆ ux ∧ up ⊆ tp de t ne peut pas être un itemset compact i e uσ < γ DEICO étend le principe d’apriori afin de générer des itemsets compacts candidats et comp ter leur support Le principe de génération est modifié par l’ajout d’un filtre sur les inter sections possibles entre candidats i e si deux itemsets compacts de taille k ont un préfixe commun mais ne partagent pas la même période alors leur croisement ne peut pas générer un itemset compact Cependant l’étape de comptage d’apriori ne peut pas s’appliquer directe ment dans notre cas Considérons c un itemset temporel candidat Une solution consisterait à compter le nombre d’apparitions de c dans cp Ce n’est pas une solution correcte Considé rons en effet le candidat c = a b [1 10] cσ généré à partir de x = a [1 10] 610 et y = b [1 10] 610 c n’est pas compact car cσ = 4 10 Toutefois sur cp il existe un itemset compact c′ = a b [7 10] 34 Notre but pendant le comptage est de construire des kernels qui correspondent aux périodes de fréquence des itemsets temporels candidats Ensuite ces kernels seront fusionnés dans le but d’obtenir les itemsets compacts La définition 7 précise ces concepts Cette définition récursive s’adapte bien au fait que l’on effectue des passes suc cessives sur les données afin de trouver les périodes qui correspondent aux itemsets compacts B Saleh et F Masseglia En effet la façon dont une passe est effectuée soit dans l’ordre séquentiel des transactions implique de découvrir les kernels “à la volée” Définition 7 Un kernel est une période L’ensemble K x P γ des kernels de l’item x sur la période P pour un support γ est défini comme suit Soit k ⊆ P une période telle que x ⊆ Tr ks ∧ Tr ks est la première apparition de x sur P Si k n’existe pas alors K = ∅ Sinon soit N l’ensemble des estampilles telles que ∀n ∈ N n ∈ P ∧ n > ks ∧ frequence x [ks n] < γ en d’autres termes N est l’ensemble des estampilles de P telles que toute extension de k à une estampille de N implique la perte de fréquence pour x Si N est vide alors ke est défini comme la dernière apparition de x dans P et K x P γ = {k} Sinon i e N 6= ∅ soit m ∈ N ∀n ∈ N n > m m est la première estampille telle que la fréquence de x est perdue sur [ks m] Alors ke est défini comme la dernière apparition de x sur [ks m] et K x P γ = {k} ∪K x P − [ks ke] γ Exemple 3 Considérons l’itemset temporel candidat de taille 1 c = b [1 10] cσ La fi gure 2 donne la table booléenne des apparitions de b Il y a deux kernels de b sur cp [1 3] et [6 10] Ces kernels peuvent être fusionnés pour obtenir un itemset compact b [1 10] 610 FIG 2 – Kernels et période de l’itemset b Algorithm MERGEKERNELS While ∃q r ∈ K couverture x q |+|couverture x r ||q∪r| ≥ γ K ← K + q ∪ r − q − r couverture x q ∪ r = couverture x q ∪ couverture x r End while End Algorithm MERGEKERNELS Notre algorithme d’extraction se base sur le principe de la génération de candidats Pendant la passe sur les données le but de l’algorithme d’extraction est de mettre à jour les informations sur les kernels des itemsets temporels candidats dont la période englobe l’estampille de la transaction courante A la fin de chaque passe de l’algorithme nous obtenons tous les kernels de chaque candidat pour cette passe A la fin de chaque passe les kernels obtenus pour chaque itemset temporel candidat sont fusionnés pour obtenir des itemsets compacts Extraction d’itemsets compacts 4 Expérimentations Les expérimentations sont réalisées sur les fichiers log Web de l’Inria Sophia de Mars 2004 à Juin 2007 qui représentent 253 Go de données brutes et 36 710 616 navigations après le prétraitement Voici un exemple de comportement trouvé grâce aux itemsets compacts 1 Joan Miro start Thu Apr 20 07 05 39 2006 end Thu Apr 20 17 21 06 2006 fre quence 0 024565 cover 120 itemset préfixe “omega personnel Christophe Berthelot ” {css style css Omega JoanMiro joanmiro html} Pour interpréter ce comportement il faut savoir que 1 cette page est dédiée à Joan Miro un artiste célèbre 2 Joan Miro est né le 20 avril 1893 et 3 la page de Christophe est classé cinquième dans les résultats Google avec les mots clés “Joan Miro” au moment de ces expé rimentations Notre conclusion est donc que pour l’anniversaire de Miro 20 avril les inter nautes ont massivement fait des recherches sur l’artiste et sont en partie passés par la page de Christophe Ce comportement se trouve également en 2004 2005 et 2007 5 Conclusion Nous avons proposé une nouvelle définition pour la découverte d’itemsets qui corres pondent à des fréquences élevées sur des périodes précises sans connaissance préalable sur ces périodes Cette découverte posait la difficulté de découvrir en même temps les itemsets et leurs périodes optimales de fréquence De plus le nombre de combinaisons possible devait être réduit et nous avons apporté les bases théoriques nécessaires à la résolution du problème Notre algorithme basé sur la découverte de ’kernels’ et leurs fusions s’est révélé efficace et capable d’extraire ce nouveau type de connaissance de manière précise et exhaustive D’après nos expérimentations les itemsets compacts constituent un résultat lisible et instructif pour mieux comprendre les données étudiées Références Agrawal R T Imielinski et A N Swami 1993 Mining association rules between sets of items in large databases In SIGMOD Washington D C USA pp 207–216 Ale J M et G H Rossi 2000 An approach to discovering temporal association rules pp 294–300 Lee C H C R Lin et M S Chen 2001 On mining general temporal association rules in a publication database pp 337–344 Summary Frequent pattern mining is a very important topic of knowledge discovery intended to extract correlations between items recorded in databases However those databases are usually considered as a whole and hence itemsets are extracted over the entire set of records In this paper we introduce the definition of solid itemsets which represent a coherent and compact behavior over a specific period 