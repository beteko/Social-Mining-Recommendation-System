 Clustering de séquences d’activités pour l’étude de procédures neurochirurgicales Germain Forestier Florent Lalys Laurent Riffaud Brivael Trelhu Pierre Jannin ENSISA MIPS Université de Haute Alsace INRIA INSERM CNRS Université de Rennes I IRISA Résumé L’utilisation de modèles de procédure chirurgicale Surgical Process Model SPM a récemment émergé dans le domaine de la conception d’outils d’intervention chirurgicale assistée par ordinateur Ces modèles qui sont utilisés pour analyser et évaluer les interventions représentent des procédures chirurgi cales Surgical Process SP qui sont formalisées comme des structures symbo liques décrivant une chirurgie à un niveau de granularité donné Un enjeu impor tant réside dans la définition de métriques permettant la comparaison et l’éva luation de ces procédures Ainsi les relations entre ces métriques et des données pré opératoires permettent de classer les chirurgies pour mettre en lumière des informations sur la procédure elle même mais également sur le comportement du chirurgien Dans ce papier nous étudions la classification automatique d’un ensemble de procédures chirurgicales en utilisant l’algorithme Dynamic Time Warping DTW pour calculer une mesure de similarité entre procédures chirur gicales L’utilisation de DTW permet de se concentrer sur les différents types d’activité effectués pendant la procédure ainsi que sur leur séquencement tout en réduisant les différences temporelles Des expériences ont été menées sur 24 procédures chirurgicales d’hernie discale lombaire dans le but de discriminer le niveau d’expertise des chirurgiens à partir d’une classification connue A l’aide d’un algorithme de clustering hiérarchique utilisant DTW nous avons retrouvé deux groupes de chirurgiens présentant des niveaux d’expertise différents junior et senior 1 Introduction Dans le domaine de l’ingénierie médicale l’analyse et la modélisation des procédures chi rurgicales sont des sujets qui ont récemment émergé Les procédures chirurgicales peuvent être décomposées en quatre niveaux de granularité Mackenzie et al 2001 les phases étapes tâches et mouvement Une intervention chirurgicale peut alors être décrite en utilisant un ni veau de granularité prédéfini afin de créer une Surgical Process appelé SP dans la suite de cet article Ces SPs peuvent être vues comme la séquence des activités effectuées par le chirur gien lors d’une intervention De fait un enjeu important réside dans la définition de méthodes permettant de comparer et de grouper automatiquement des SPs similaires afin d’identifier des motifs qui peuvent par la suite être mis en relation avec des données pré opératoires afin d’analyser de manière précise un type de chirurgie 137 Clustering de séquences d’activités Le principal problème d’une telle analyse est la définition de mesures de similarité entre SPs qui permettent de mettre en lumière de manière objective et quantitative les différences entre des procédures chirurgicales En effet les SPs d’un même type d’intervention peuvent avoir une variabilité importante qui peut être due à différents paramètres tel que la technique d’opération la difficulté intrinsèque de la chirurgie ou encore l’expertise du chirurgien Récem ment Riffaud et al 2010 ont proposé la définition de métriques de similarité calculées à l’aide d’outils statistiques pour comparer des groupes de chirurgiens junior et senior c’est à dire avec peu ou beaucoup d’expérience Faisant suite à ces travaux nous proposons dans cet article de définir une nouvelle approche utilisant l’algorithme Dynamic Time Warping DTW Hiroaki et Chiba 1978 afin d’évaluer la similarité entre SPs L’utilisation de DTW nous permet de nous concentrer sur le séquencement des différentes activités qui composent une SPs En effet DTW réduit l’importance des différences temporelles et se concentre sur le nombre d’activités et leur organisation dans la chronologie de la chirurgie A l’aide de DTW nous avons étudié la classification automatique d’un ensemble de SPs à travers l’utilisation d’un algorithme de clustering hiérarchique ascendant Ainsi nous présentons des résultats pour le clustering de 24 SPs correspondant à des chirurgies d’hernie lombaire discale pratiquées pour moitié par des chirurgiens juniors et pour moitié par des chirurgiens seniors Les résultats montrent que notre approche a réussi de manière automatique à retrouver ces deux groupes de chirurgiens Dans la Section 2 le formalisme et l’utilisation de DTW pour la comparaison de procédures sont présentés La Section 3 présente les résultats des expériences et la Section 4 conclut l’article 2 Méthodes 2 1 Séquence d’activités composant le processus chirurgical Une procédure chirurgicale Surgical Process SP peut être vue comme une séquence re présentant les activités aci effectuées par le chirurgien pendant la chirurgie L’ensemble de ces activités étant noté AC avec aci ∈ AC aci étant la ième activité Chaque activité dans une SP contient plusieurs informations représentées par un triplet aci =< a s i > a ∈ A s ∈ S i ∈ Imi 1 avecA l’ensemble des actions possibles e g {cut remove } S l’ensemble des struc tures anatomiques e g {skin dura matter } I l’ensemble des instruments possibles e g {scalpel scissors } et mi le nombre d’instruments utilisés pour réaliser l’activité aci Un exemple d’activité peut être <cut skin scalpel> Ainsi le domaine de définition d’une activité est donné par A × S × Imi Ces ensembles sont généralement spécifiques à un type de chirurgie et une ontologie peut être utilisée pour décrire le vocabulaire pour un type défini Neumuth et al 2010 En plus des informations sur l’action a la structure anatomique s et l’instrument utilisé i chaque activité a un début start aci et une fin stop aci dans la chronologie de la chirurgie start → R stop → R Notons que start aci < stop aci induit un ordre partiel sur les activités Une procédure chirurgicale spk peut ainsi être vue comme une séquence d’activités pra tiquées pendant une chirurgie Chacune des activités appartient à l’ensemble des différentes activités présentes pendant la chirurgie ACk 138 Forestier et al spk =< ac k 1 ac k 2 ac k nk > | ac k i ∈ ACk 2 2 2 Comparaison de procédures à l’aide de Dynamic Time Warping Un enjeu important réside dans la définition de métriques permettant d’évaluer la similarité entre SPs En effet définir une mesure de similarité est souvent la première étape pour identi fier des motifs parmi un ensemble d’objets Comme une SP peut être vue comme une séquence d’activités nous proposons d’utiliser l’algorithme Dynamic Time Warping DTW Hiroaki et Chiba 1978 afin de les comparer DTW est basé sur la distance de Levenshtein ou distance d’édition et a été initialement utilisé dans des applications de reconnaissance de voix Il per met de trouver l’alignement optimal entre deux séquences et de capturer la similarité lors de l’alignement de ces deux séquences Afin de pouvoir utiliser DTW pour comparer deux sé quences une mesure de similarité doit être définie entre les différents éléments composant la séquence Dans notre cas cela implique la définition d’une distance entre deux activités Ainsi nous avons défini une fonction binaire renvoyant 0 si les trois composantes Eq 1 des deux activités sont identiques et 1 sinon d aci acj =    0 if aci a = acj a et aci s = acj s et aci i = acj i 1 sinon 3 avec = un opérateur booléen qui réalise la comparaison entre l’action la structure anato mique et l’instrument utilisé e g d <cut skin scalpel> <cut skin scalpel> =0 Pour comparer deux SPs en utilisant DTW les séquences d’activités sont étirées en consi dérant le début et la fin de chaque activité Cette étape est nécessaire pour avoir les SPs sur la même échelle temporelle et pouvoir ainsi comparer les activités effectuées dans chaque SP à un instant donné t pendant la chirurgie L’activité pratiquée à l’instant t est définie comme aci t ssi t ∈ [start aci stop aci ] Notons qu’il n’est pas nécessaire que les deux SPs aient la même durée la seule hypothèse étant que la première activité ait commencé à l’instant t = 0 dans les deux SPs Considérons deux SPs spk =< ac k 1 ac k 2 ac k nk > et spl =< ac l 1 ac l 2 ac l nl > le coup de l’alignement optimal peut être calculé récursivement par d spk t spl t = 4 d ac k i t ac l j t +min    d spk t− 1 spl t− 1 d spk t spl t− 1 d spk t− 1 spl t où spk t est la sous séquence < ac k 1 ac k i t > DTW a déjà été utilisé avec succès comme mesure de similarité pour effectuer du clustering Petitjean et al 2011 De manière similaire nous proposons d’utiliser la mesure de similarité fournie par DTW pour identifier automatiquement des clusters de chirurgies similaires Nous 139 Clustering de séquences d’activités sp1 ac 1 1︷ ︸︸ ︷ ac 1 2︷︸︸︷ ac 1 3︷︸︸︷ temps0 N1 FIG 1 – Exemple de SP avec trois activités avons ainsi utilisé un algorithme de clustering hiérarchique ascendant avec la méthode du lien moyen average link Anderberg 1973 qui consiste à évaluer la similarité entre deux clusters par la similarité moyenne entre les couples d’objets des deux clusters 2 3 Visualisation des procédures chirurgicales Il est en général utile de posséder une représentation visuelle des données pour pouvoir les explorer Cependant les structures de données complexes posent parfois problème pour définir une visualisation aisée Dans le cas des SPs nous proposons d’utiliser des index plot Sche rer 2001 qui ont déjà été utilisés avec succès pour la visualisation de séquences Le principe des index plot est d’afficher une séquence représentant les activités comme des rectangles pos sédant une couleur par activité différente et avec une largeur proportionnelle à sa durée i e stop aci −start aci Il est ainsi possible de visualiser facilement les SPs et d’effectuer une comparaison visuelle La figure 1 présente une SP sp1 =< ac 1 1 ac 1 2 ac 1 3 > avec trois activités différentes 3 Expériences Vingt quatre procédures 10 hommes 14 femmes avec un âge médian de 52 ans de chirur gie d’hernie lombaire ont été enregistrées dans le département de neurochirurgie de l’université de Leipzig en Allemagne Une procédure peut être divisée en 3 principales étapes l’approche du disque hernié la discectomie comprenant la dissection et l’enlèvement du disque et la phase de fermeture Une étape d’hemostase peut parfois être nécessaire avant la phase de fermeture Cinq chirurgiens seniors et cinq chirurgiens juniors ont participé à cette étude Les chirur giens seniors ayant déjà pratiqué plus de 100 retraits d’hernie et les juniors ayant effectué au moins deux ans d’internat Parmi les 24 procédures enregistrées 12 ont été pratiquées par un chirurgien senior avec l’aide d’un chirurgien junior et 12 ont été pratiquées par un chirurgien junior avec l’aide d’un chirurgien senior Durant l’enregistrement des procédures effectuées par les chirurgiens juniors seule la dernière étape a été pratiquée par le chirurgien junior sans l’aide du chirurgien senior Ainsi dans cette étude nous nous sommes concentrés uniquement sur cette dernière étape pour pouvoir mieux discriminer les comportements entre chirurgien junior et senior Les données ont été acquises à l’aide du logiciel Surgical Workflow Editor Neumuth et al 2006 Elles ont été enregistrées par un observateur humain un neurochirurgien senior qui a utilisé une tablette au cours de l’opération La Figure 2 présente le dendrogramme obtenu par l’application de l’algorithme de cluste ring hiérarchique ascendant CHA sur la phase de fermeture L’index plot représentant cha 140 Forestier et al 20 40 60 80 100 120 S im ila ri ty c lu s te r c o m b in e 1 jun 2 jun 3 jun 4 jun 5 jun 6 jun 7 jun 8 jun 9 jun 10 jun 11 jun 12 jun 13 sen 14 sen 15 sen 16 sen 17 sen 18 sen 19 sen 20 sen 21 sen 22 sen 23 sen 24 sen Patient id Experience FIG 2 – Dendrogramme résultant du clustering des 24 procédures considérées cune des SPs est affiché en dessous du dendrogramme Trois clusters émergent visuellement de cette analyse En coupant le dendrogramme pour obtenir 2 clusters 12 chirurgies sont pré sentes dans chaque cluster Le premier cluster à gauche en vert et bleu contient 10 chirurgies pratiquées par des chirurgiens seniors et 2 par des chirurgiens juniors Le second cluster à droite en rouge quant à lui contient 10 chirurgies pratiquées par des chirurgiens juniors et 2 chirurgies pratiquées par des chirurgiens seniors De plus dans le premier cluster deux sous clusters sont présents rouge et bleu qui contiennent chacun 6 chirurgies En conservant les deux clusters principaux une précision de 83 33% peut être calculée en considérant que 20 chirurgies sur 24 sont bien classées 4 Conclusion Dans cet article nous avons proposé une nouvelle métrique basée sur l’algorithme DTW pour la comparaison et l’évaluation de procédures chirurgicales Cette approche permet de se concentrer sur l’analyse des différentes activités effectuées pendant une chirurgie ainsi que leur séquencement et minimise l’importance des différences temporelles Des résultats sur le clustering de procédures chirurgicales permettant d’identifier automatiquement le niveau d’expertise du chirurgien ont été présentés Une des pistes que nous explorons actuellement s’intéresse à l’introduction de sémantique dans la mesure de similarité entre activités En effet la comparaison binaire utilisée pourrait être améliorée en prenant en compte la sémantique des actions structures anatomiques et instruments permettant ainsi une analyse plus précise 141 Clustering de séquences d’activités Nous souhaitons également essayer de mettre en relation les résultats obtenus avec d’autres variables pré opératoires par exemple la difficulté de la chirurgie le devenir du patient etc afin d’expliquer les sous clusters identifiés Références Anderberg M 1973 Cluster analysis for applications Technical report Academic Press Hiroaki S et S Chiba 1978 Dynamic programming algorithm optimization for spoken word recognition IEEE Transactions on Acoustics Speech and Signal Processing 26 43–49 Mackenzie C J Ibbotson C Cao et A Lomax 2001 Hierarchical decomposition of laparo scopic surgery a human factors approach to investigating the operating room environment Minimally Invasive Therapy and Allied Technologies 10 3 121–127 Neumuth T N Durstewitz M Fischer G Strauß A Dietz J Meixensberger P Jannin K Cleary H Lemke et O Burgert 2006 Structured recording of intraoperative surgical workflows In SPIE Medical Imaging Volume 6145 pp 61450A Neumuth T P Jannin J Schlomberg J Meixensberger P Wiedemann et O Burgert 2010 Analysis of surgical intervention populations using generic surgical process models Inter national Journal of Computer Assisted Radiology and Surgery 6 59–71 Petitjean F A Ketterlin et P Gançarski 2011 A global averaging method for dynamic time warping with applications to clustering Pattern Recognition 44 678–693 Riffaud L T Neumuth X Morandi C Trantakis J Meixensberger O Burgert B Trelhu et P Jannin 2010 Recording of surgical processes a study comparing senior and junior neurosurgeons during lumbar disc herniation surgery Neurosurgery 67 325–332 Scherer S 2001 Early career patterns A comparison of Great Britain and West Germany European Sociological Review 17 2 119 Summary Towards the creation of new computer assisted intervention systems Surgical Process Models SPMs is an emerging concept used for analyzing and assessing surgical interven tions SPMs represent Surgical Process SPs which are formalized as symbolic structured descriptions of surgical interventions using a pre defined level of granularity and a dedicated terminology In this context an important challenge is the creation of new metrics for the com parison and the evaluation of SPs Thus the relations between these metrics and pre operative data allow to classify surgeries and highlight specific information on the surgery itself and on the surgeon such as his her level of expertise In this paper we explore the automatic classifi cation of a set of SPs based on the Dynamic Time Warping DTW algorithm DTW allows to compute a distance between two SPs that focuses on the different types of activities performed during surgery and their sequencing by minimizing time differences Unsupervised classifi cation experiments have shown that this approach was able to automatically identify groups of surgeons according to their level of expertise senior and junior 142 